---
title: "LR_3"
author: "Zubareva Marina"
date: '13 ноября 2017 г '
output: html_document
---

### Задачи для лабораторной: 
* работа с текстом;
* использование регулярных выражений для извлечения данных;
* переписывание существующего кода;
* ассиметричные распределения.

### Требования к оформлению
* Оформить решение в R Markdown. 
* Сохранить файл в свой репозиторий.
* Выгрузить R Markdown в HTML, назвать своим именем и отправить по почте (если хочется сдать раньше или нужна помощь).

### Исходные данные
Файл _forbes.htm_ содержит список богатейших американцев по версии журнала Форбс.
На его примере потренируемся в разборе html страниц.

#### Задание 1
1. Используйте команду ``readLines`` для загрузки файла в текстовый вектор _html_.

```{r}
 forbesD <- readLines("https://raw.githubusercontent.com/SergeyMirvoda/MD-DA-2017/master/data/forbes.htm")
```
   a) Сколько строк в файле?
```{r}
   length(forbesD) # 1991
```
   b) Сколько символов в файле?
```{r}
  sum(nchar(forbesD)) # 80380
```
  
2. Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне и запомните размер их дохода.

Доход Билла Гейтса: 72$

Доход Ларри Эллисона: 41$

3. Напишите шаблон регулярного выражения и используйте функцию ``grep``, чтобы извлечь размер дохода из данных в векторе _html_.
Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей и ссылается на номера строк в котрых действительно есть
информация о доходе, а не просто первый попавшийся текст.
```{r}
pattern <- "[$]\\d{,2}[,]?\\d{,2}?\\s[B]"
forbes.profit <- grep(pattern, forbesD)
length(forbes.profit) == 100
print("Строки со сведениями о доходе:")
forbesD[forbes.profit] #видно, что выводится 100 записей с доходами
```

4. Напишите код, использовав регулярное выражение из п. 3, и функции ``regexp`` и ``regmatches``, чтобы извлечь все данные о доходе.
Проверьте следующее:
```{r}
forbes.allprofit <- regmatches(forbesD, regexpr(pattern, forbesD)) #создание вектора доходов
```
   a) Должно быть ровно сто значений.
```{r}
length(forbes.allprofit)
```   
   b) Самый большой доход должен быть доход Билла Гейтса
```{r}
forbes.allprofit[1]
```   
   c) Такой доход должен быть в списке один раз.
```{r}
length(forbes.allprofit[forbes.allprofit=="$72 B"]) #доход, как у Билла Гейтса, встречается только 1 раз
```   
   d) В всписке должна быть цифра, которую мы запомнили для Ларри Эллисона.
```{r}
forbes.allprofit[forbes.allprofit=="$41 B"] #вывод дохода Ларри Эллисона
```   
   e) Должно быть как минимум два значения, встречающихся несколько раз.
```{r}
length(unique(forbes.allprofit)); #66 элементов из 100 являются уникальными
``` 

#### Задание 2
5. В данных доход представлен в формате **"$42 B"**, что означает **42 × 10^9**.
Преобразуйте этот формат в числовой и сохраните в вектор _worths_. 
```{r}
forbes.allprofit_new<-regmatches(forbesD, regexpr(pattern,forbesD)) 
forbes.allprofit_new<-sub(",",".",forbes.allprofit_new)
forbes.allprofit_new<-substr(forbes.allprofit_new,2,nchar(forbes.allprofit_new)-2)
worths<-as.numeric(forbes.allprofit_new)*10^9
``` 
Удостоверьтесь в следующем:
   a. worths является вектором и в нём сто занчений типа double.
```{r}
is.double(worths)
``` 
   b. Все элементы вектора _worths_ больше 1 миллиарда.
```{r}
length(worths[worths>10^9])
``` 
   c. Самое большое число это доход Билла Гейтса.
```{r}
max(worths); #7.2*10^10 
``` 
6. Используйте вектор _worths_ , чтобы выяснить следующее:
   a. Какова медиана ста этих записей?
```{r}
median(worths) #медиана: 8.3*10^9
``` 
   b. Средний доход?
```{r}
mean(worths) #средний доход: 1.293*10^10
``` 
   c. Как много людей из этого списка имеют доход больше 5млрд., 10, 25?
```{r}
length(worths[worths>5*10^9]) #89 людей из списка имеют доход свыше 5 млрд.
length(worths[worths>10*10^9]) #39 людей из списка имеют доход свыше 10 млрд.
length(worths[worths>25*10^9]) #12 людей из списка имеют доход свыше 25 млрд.
``` 
   d. Какой их общий доход?
```{r}
sum(worths) #общий доход: 1.293*10^12
``` 
   e. Какую долю от общего дохода, составляет пятёрка самых богатых.
```{r}
sum(worths[1:5])/sum(worths) #доля от общего дохода для пятерки самых богатых: 0.1883217
``` 
   f. Какую долю от общего дохода, составляют 20 самых богатых.
```{r}
sum(worths[1:20])/sum(worths) #доля от общего дохода для двадцати самых богатых: 0.4921114
``` 
   g. В данных [федерального резерва США](https://www.federalreserve.gov/releases/z1/current/z1.pdf) найдите
   показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю
   общего дохода составляют 100 богатейших людей. 
```{r}
household.net.worth<-78536*10^9 #доход всех домохозяйств за 2013 год
sum(worths)/household.net.worth #доля 100 богатейших людей от общего дохода всех домохозяйств: 0.01646379
``` 
